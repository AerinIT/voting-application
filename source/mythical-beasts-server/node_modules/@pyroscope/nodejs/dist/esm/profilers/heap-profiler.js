import { heap } from '@datadog/pprof';
import debug from 'debug';
const log = debug('pyroscope::profiler::heap');
export class HeapProfiler {
    labels;
    lastProfiledAt;
    constructor() {
        this.labels = {};
        this.lastProfiledAt = new Date();
    }
    getLabels() {
        return this.labels;
    }
    profile() {
        log('profile');
        const profile = heap.profile();
        const lastProfileStartedAt = this.lastProfiledAt;
        this.lastProfiledAt = new Date();
        return {
            profile,
            startedAt: lastProfileStartedAt,
            stoppedAt: this.lastProfiledAt,
        };
    }
    setLabels(labels) {
        this.labels = labels;
    }
    start(args) {
        log('start');
        this.lastProfiledAt = new Date();
        heap.start(args.samplingIntervalBytes, args.stackDepth);
    }
    stop() {
        log('stop');
        heap.stop();
        return null;
    }
}
